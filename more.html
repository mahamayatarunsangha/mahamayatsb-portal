<!DOCTYPE html>
<html lang="en">
<head>

      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
      <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/2536/2536805.png">
      <script src="auth.js"></script>

      <link rel="icon" type="image" href="https://i.postimg.cc/3x37zcx6/Plugin-icon-1-2.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আরও অপশন</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // Firebase Configuration (provided by the user)
        const firebaseConfig = {
            apiKey: "AIzaSyArbew0cZvslAoL_RQDGUXJruRe3KZ0-tw",
            authDomain: "user-server-3109c.firebaseapp.com",
            projectId: "user-server-3109c",
            storageBucket: "user-server-3109c.firebasestorage.app",
            messagingSenderId: "858925400319",
            appId: "1:858925400319:web:83e266d27becb4c7664cca"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Make Firebase instances globally accessible for the main script
        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        window.onAuthStateChanged = onAuthStateChanged;
        window.ref = ref;
        window.onValue = onValue;
        window.signOut = signOut; // Expose signOut for the logout button
    </script>
    <style>
        /* Custom font import for Hind Siliguri, Noto Sans Bengali (for Bengali text) */
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Hind Siliguri', 'Noto Sans Bengali', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f8f8f8; /* Light background for the overall page */
        }

        /* Custom styles for the icon background and color */
        .icon-bg-orange {
            background-color: #ffebe5; /* Light orange */
        }
        .icon-text-orange {
            color: #ff7f50; /* Orange */
        }
    </style>
</head>
<body class="flex justify-center min-h-screen p-4 sm:p-6 md:p-8">
    <div class="container w-full max-w-md bg-white shadow-lg rounded-xl overflow-hidden">
        <div class="flex items-center p-5 sm:p-6 md:p-7 bg-white border-b border-gray-100">
            <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-blue-100 flex items-center justify-center overflow-hidden mr-4 sm:mr-5 flex-shrink-0">
                <img src="https://i.postimg.cc/nL30L7ck/Sample.png" alt="User Avatar" class="w-full h-full object-cover rounded-full">
            </div>
            <div class="flex flex-col">
                <h1 id="user-name" class="text-xl sm:text-2xl font-semibold text-gray-800 mb-1">Loading Name...</h1>
                <p id="user-phone" class="text-sm sm:text-base text-gray-600">Loading Phone...</p>
                <p id="user-email" class="text-sm sm:text-base text-gray-600">Loading Email...</p>
                <p id="user-id" class="text-xs text-gray-400 mt-1">User ID: N/A</p>
                <p id="auth-status" class="text-xs text-gray-500 mt-1">Auth Status: Checking...</p>
            </div>
        </div>
        <div class="py-3 sm:py-4">
            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="https://mahamayatarunsangha.github.io/mahamayatsb-admin-portal/">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-user-shield"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow">অ্যাডমিন পোর্টাল</span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="#">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-cash-register"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow"><a href="https://mahamayatarunsangha.github.io/mahamayatsb-casher-portal/" style="text-decoration: none;">ক্যাশিয়ার পোর্টাল</a></span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="https://docs.google.com/document/d/1TDg213L30TnlAz6jVPr7UbKzFI9msCoyZP_CkfhxrRs/edit?usp=sharing">



                
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-scroll"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow">শর্তাবলী ও নির্দেশনা</span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="documents-center.html">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-database"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow">তথ্য ভান্ডার</span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="profile-page.html">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-user-circle"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow"><a href="profile.html" style="text-decoration: none;">প্রোফাইল</a></span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="error.html">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-language"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow">ভাষা</span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-gray-50 transition-colors duration-200 rounded-lg mx-3 mb-2" data-page="error.html">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg icon-bg-orange icon-text-orange flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-cog"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-gray-800 font-medium flex-grow">
                    <a href="error.html" style="text-decoration: none;">সেটিংস</a></span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>

            <div id="logout-button" class="menu-item flex items-center px-5 py-3 sm:py-3.5 cursor-pointer hover:bg-red-50 transition-colors duration-200 rounded-lg mx-3">
                <div class="menu-item-icon w-10 h-10 sm:w-11 sm:h-11 rounded-lg bg-red-100 text-red-600 flex items-center justify-center text-lg sm:text-xl mr-4">
                    <i class="fas fa-sign-out-alt"></i> </div>
                <span class="menu-item-text text-base sm:text-lg text-red-600 font-medium flex-grow">লগ আউট</span>
                <i class="fas fa-chevron-right text-gray-400 text-sm sm:text-base"></i>
            </div>
        </div>
    </div>

    <script type="module">
        window.onload = async () => {
            const auth = window.firebaseAuth;
            const database = window.firebaseDatabase;
            const onAuthStateChanged = window.onAuthStateChanged;
            const ref = window.ref;
            const onValue = window.onValue;
            const signOut = window.signOut; // Get signOut function

            const userNameElement = document.getElementById('user-name');
            const userPhoneElement = document.getElementById('user-phone');
            const userEmailElement = document.getElementById('user-email');
            const userIdElement = document.getElementById('user-id');
            const authStatusElement = document.getElementById('auth-status');
            const logoutButton = document.getElementById('logout-button');

            console.log("Script loaded. Waiting for Firebase Auth state...");

            // Listen for authentication state changes
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in.
                    console.log("User is signed in.");
                    console.log("Firebase Auth User Object:", user); // IMPORTANT: Inspect this object in your browser console!
                    authStatusElement.textContent = `Auth Status: Logged In`;
                    userIdElement.textContent = `User ID: ${user.uid}`;

                    // Check if email or displayName are directly available from Auth
                    // These might be populated if the user signed up with email/password or a provider that includes them.
                    userEmailElement.textContent = user.email || 'Email N/A from Auth';
                    userNameElement.textContent = user.displayName || 'Name N/A from Auth';
                    userPhoneElement.textContent = user.phoneNumber || 'Phone N/A from Auth';


                    // --- Realtime Database Data Retrieval ---
                    // CORRECTED PATH based on your provided database structure, including 'artifacts/default-app-id'
                    // This assumes your data is under:
                    // /artifacts/default-app-id/users/{YOUR_USER_UID}/user_profiles
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Get __app_id from Canvas environment
                    const userProfileRef = ref(database, `artifacts/${appId}/users/${user.uid}/user_profiles`); // <-- Path corrected here!
                    console.log(`Attempting to read from Realtime Database path: artifacts/${appId}/users/${user.uid}/user_profiles`);


                    onValue(userProfileRef, (snapshot) => {
                        const data = snapshot.val();
                        console.log("Realtime Database data snapshot:", data); // IMPORTANT: Inspect this data

                        if (data) {
                            // Use data from Realtime DB if available, otherwise fallback to Auth properties
                            userNameElement.textContent = data.name || user.displayName || 'Name not found';
                            userPhoneElement.textContent = data.phoneNumber || user.phoneNumber || 'Phone not found';
                            userEmailElement.textContent = data.email || user.email || 'Email not found';
                            console.log("User profile data fetched from Realtime DB:", data);
                        } else {
                            // If no data in Realtime DB, show what's available from Auth or a message
                            userNameElement.textContent = user.displayName || 'Profile Not Found in DB';
                            userPhoneElement.textContent = user.phoneNumber || 'Check DB path/rules';
                            userEmailElement.textContent = user.email || 'No DB profile data';
                            console.warn(`No profile data found at 'artifacts/${appId}/users/${user.uid}/user_profiles'. Please check your database structure and rules.`);
                        }
                    }, (error) => {
                        console.error("Firebase Realtime Database read error:", error);
                        userNameElement.textContent = "DB Read Error";
                        userPhoneElement.textContent = "See console for details";
                        userEmailElement.textContent = "";
                    });

                } else {
                    // User is signed out.
                    console.log("User is signed out.");
                    authStatusElement.textContent = `Auth Status: Logged Out`;
                    userNameElement.textContent = 'Please Log In';
                    userPhoneElement.textContent = '';
                    userEmailElement.textContent = '';
                    userIdElement.textContent = `User ID: N/A`;
                    // No automatic redirect here, as the user might be manually logged out.
                }
            });

            // Handle Logout Button
            logoutButton.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    console.log("User logged out successfully.");
                    // Redirect to login page after successful logout
                    window.location.href = "login.html"; // Assuming your login page is named login.html
                } catch (error) {
                    console.error("Error signing out:", error);
                    // Use custom message box instead of alert()
                    const messageBox = document.createElement('div');
                    messageBox.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    messageBox.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                            <p class="text-lg font-semibold mb-4">Error signing out: ${error.message}</p>
                            <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">Close</button>
                        </div>
                    `;
                    document.body.appendChild(messageBox);

                    messageBox.querySelector('button').addEventListener('click', () => {
                        document.body.removeChild(messageBox);
                    });
                }
            });

            // Basic JavaScript for other menu item interaction (optional)
            const menuItems = document.querySelectorAll('.menu-item:not(#logout-button)'); // Exclude logout button
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page; // Get the page to navigate to
                    if (page) {
                        console.log(`Navigating to: ${page}`);
                        window.location.href = page;
                    } else {
                        const text = item.querySelector('.menu-item-text').textContent;
                        console.log(`Clicked on: ${text} (No page defined)`);
                        const messageBox = document.createElement('div');
                        messageBox.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                        messageBox.innerHTML = `
                            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                                <p class="text-lg font-semibold mb-4">You clicked on "${text}"</p>
                                <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">Close</button>
                            </div>
                        `;
                        document.body.appendChild(messageBox);

                        messageBox.querySelector('button').addEventListener('click', () => {
                            document.body.removeChild(messageBox);
                        });
                    }
                });
            });
        };
    </script>
</body>
</html>
